<!DOCTYPE html>
<!--
  Copyright 2010 Google Inc.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

  Original slides: Marcin Wichary (mwichary@google.com)
  Modifications: Ernest Delgado (ernestd@google.com)
                 Alex Russell (slightlyoff@chromium.org)

  landslide modifications: Adam Zapletal (adamzap@gmail.com)
                           Nicolas Perriault (nperriault@gmail.com)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Kubernetes II.</title>

  
     <link rel="stylesheet" href="file:///usr/local/lib/python3.10/dist-packages/darkslide/themes/default/css/base.css">
  

  
     <link rel="stylesheet" href="file:///usr/local/lib/python3.10/dist-packages/darkslide/themes/default/css/print.css">
  

  
     <link rel="stylesheet" href="file:///usr/local/lib/python3.10/dist-packages/darkslide/themes/default/css/screen.css">
  

  
     <link rel="stylesheet" href="file:///usr/local/lib/python3.10/dist-packages/darkslide/themes/default/css/theme.css">
  


  
    <script type="text/javascript" src="file:///usr/local/lib/python3.10/dist-packages/darkslide/themes/default/js/slides.js"></script>
  

</head>
<body>
  <div id="blank"></div>
  <div class="presentation">
    <div id="current_presenter_notes">
      <div id="presenter_note"></div>
    </div>
    <div class="slides">
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-1">
          <div class="inner">
            
            <header><h1>Kubernetes II.</h1></header>
            
            
            <section><p>Online poznámky: <a href="https://codimd.trask.cz/s/rJPCa8C0v">https://codimd.trask.cz/s/rJPCa8C0v</a></p>
<p>Použitý cluster: <a href="https://arm.lab.trask.cz/">https://arm.lab.trask.cz/</a></p>
<p>Adam Morávek, amoravek@trask.cz, +420 724 514 916</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              1/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-2">
          <div class="inner">
            
            <header><h1>Requests, limits v k9s</h1></header>
            
            
            <section><ul>
<li>ukázka v k9s</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              2/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-3">
          <div class="inner">
            
            <header><h1>kubectl ... -o jsonpath</h1></header>
            
            
            <section><p><code>kubectl get pod k8s-sample-app-648d688cfc-8h7hx -o jsonpath='{.spec.nodeName}'</code></p>
<p><code>kubectl get pod k8s-sample-app-648d688cfc-8h7hx -o jsonpath='{range .spec.containers[*]}{.name}{"\t"}{.image}'</code></p>
<p><a href="https://kubernetes.io/docs/reference/kubectl/jsonpath/">https://kubernetes.io/docs/reference/kubectl/jsonpath/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              3/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-4">
          <div class="inner">
            
            <header><h1>Autentizace - pokračování</h1></header>
            
            
            <section><ul>
<li>User vs. ServiceAccount</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              4/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-5">
          <div class="inner">
            
            <header><h1>Autentizace - x509</h1></header>
            
            
            <section><ul>
<li>kubeconfig - podrobněji</li>
<li>Kubernetes PKI (viz k8s/examples/k8s/security/create-user.sh)</li>
<li>nutny cluster admin</li>
<li>User a Group - vazba na DN (opět viz create-user.sh)</li>
</ul>
<p><a href="https://kubernetes.io/docs/tasks/tls/managing-tls-in-a-cluster/">https://kubernetes.io/docs/tasks/tls/managing-tls-in-a-cluster/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              5/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-6">
          <div class="inner">
            
            <header><h1>Autentizace - bootstrap tokens</h1></header>
            
            
            <section><p><code>kubeadm token create</code> -&gt; <code>lsvnin.y4cc92mo4zrd7ea7</code> (<code>&lt;user&gt;.&lt;secret&gt;</code>)</p>
<p>(user = lsvnin, secret = y4cc92mo4zrd7ea7)</p>
<p><code>system:bootstrap:&lt;user&gt;</code></p>
<p><code>system:bootstrappers</code> - skupina, kde jsou všechny <code>system:bootstrap:*</code> účty</p>
<p>Token buď do .kube/config nebo <code>kubectl ... --token &lt;token&gt;</code></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              6/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-7">
          <div class="inner">
            
            <header><h1>Autentizace - bootstrap tokens (příklady)</h1></header>
            
            
            <section><p><code>kubectl create rolebinding system:bootstrap:lsvnin-default-admin --clusterrole cluster-admin --user system:bootstrap:lsvnin -n default</code></p>
<p><code>kubectl create rolebinding bootstrapers-default-admin --clusterrole admin --group system:bootstrappers --namespace default</code></p>
<p><code>kubectl create clusterrolebinding system:bootstrap:lsvnin-cluster-admin --clusterrole cluster-admin --user system:bootstrap:lsvnin</code></p>
<p><a href="https://kubernetes.io/docs/reference/access-authn-authz/bootstrap-tokens/">https://kubernetes.io/docs/reference/access-authn-authz/bootstrap-tokens/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              7/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-8">
          <div class="inner">
            
            <header><h1>Autentizace - Service Account Tokens</h1></header>
            
            
            <section><p><code>kubectl create serviceaccount jenkins</code></p>
<p><code>kubectl create token jenkins</code></p>
<p>User: <code>system:serviceaccount:(NAMESPACE):(SERVICEACCOUNT)</code></p>
<p>Group: <code>system:serviceaccounts</code></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              8/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-9">
          <div class="inner">
            
            <header><h1>OpenID Connect</h1></header>
            
            
            <section><p><a href="https://kubernetes.io/docs/reference/access-authn-authz/authentication/#openid-connect-tokens">https://kubernetes.io/docs/reference/access-authn-authz/authentication/#openid-connect-tokens</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              9/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-10">
          <div class="inner">
            
            <header><h1>kubeconfigy (kdo nemá)</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              10/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-11">
          <div class="inner">
            
            <header><h1>RBAC (Role-Based Access Control)</h1></header>
            
            
            <section><ul>
<li>dá se vypnout (default = </li>
<li>příklad - Users + Group 'skoleni'</li>
<li>Role</li>
<li>ClusterRole</li>
<li>RoleBinding</li>
<li>ClusterRoleBinding</li>
</ul>
<p>Seznam verbs: <code>kubectl api-resources --sort-by name -o wide</code></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              11/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-12">
          <div class="inner">
            
            <header><h1>RBAC - cvičení 1</h1></header>
            
            
            <section><ul>
<li>nová role pro PKI (namespaced)</li>
<li>CertificateSigningRequest</li>
<li>certificate approve</li>
</ul>
<p><a href="https://kubernetes.io/docs/reference/access-authn-authz/certificate-signing-requests/">https://kubernetes.io/docs/reference/access-authn-authz/certificate-signing-requests/</a></p>
<p><code>kubectl api-resources --verbs=list --api-group certificates.k8s.io -o wide</code></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              12/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-13">
          <div class="inner">
            
            <header><h1>Řešení</h1></header>
            
            
            <section><p><code>kubectl create clusterrole pki-admin --resource certificatesigningrequest.certificates.k8s.io --verb create,get,list,watch</code></p>
<p><code>kubectl create clusterrolebinding pki-admin-amo-amoravek --clusterrole pki-admin --namespace amo --user amoravek</code></p>
<p>Proč <strong>cluster</strong>rolebinding a ne rolebinding?
Protože <code>certificatesigningrequest</code> není <em>namespaced</em> resource.</p>
<p>Approval:</p>
<p>Verbs: update, group: certificates.k8s.io, resource: certificatesigningrequests/approval</p>
<p>Verbs: approve, group: certificates.k8s.io, resource: signers, resourceName: <signerNameDomain>/<signerNamePath> or <signerNameDomain>/*</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              13/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-14">
          <div class="inner">
            
            <header><h1>RBAC - cvičení 2</h1></header>
            
            
            <section><ul>
<li>umožnit všem uživatelům naráz získat informace o nodech (kubectl get/describe nodes)</li>
<li>Hint: všichni jsou ve skupině <code>skoleni</code> --&gt; <code>--group</code></li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              14/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-15">
          <div class="inner">
            
            <header><h1>Řešení</h1></header>
            
            
            <section><p><code>kubectl create clusterrolebinding skoleni-view --group skoleni --clusterrole view</code></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              15/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-16">
          <div class="inner">
            
            <header><h1>Readiness a Liveness probes - pokračování</h1></header>
            
            
            <section><ul>
<li>kompletní ukázka chování při výpadku liveness i readiness probe</li>
<li>ukázka výpadků v případě chybějící readiness proby</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              16/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-17">
          <div class="inner">
            
            <header><h1>Hledání problémů</h1></header>
            
            
            <section><ul>
<li>scaling - neudělá požadovaný počet replik</li>
<li>kontrola logů controller-managera; možné příčiny<ul>
<li>kvóty</li>
<li>existuje PodDisruptionBudget</li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              17/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-18">
          <div class="inner">
            
            <header><h1>LimitRange</h1></header>
            
            
            <section><ul>
<li>default limits</li>
</ul>
<p><a href="https://kubernetes.io/docs/concepts/policy/limit-range/">https://kubernetes.io/docs/concepts/policy/limit-range/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              18/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-19">
          <div class="inner">
            
            <header><h1>ResourceQuota</h1></header>
            
            
            <section><ul>
<li>
<p>PriorityClass</p>
<p>kubectl create quota my-quota \
  --hard=cpu=1,memory=1G,pods=2,services=3,replicationcontrollers=2,resourcequotas=1,secrets=5,persistentvolumeclaims=10</p>
</li>
</ul>
<p><a href="https://kubernetes.io/docs/concepts/policy/resource-quotas/">https://kubernetes.io/docs/concepts/policy/resource-quotas/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              19/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-20">
          <div class="inner">
            
            <header><h1>kubectl patch (1)</h1></header>
            
            
            <section><p><code>kubectl patch serviceaccount default -p '{"imagePullSecrets": [{"name": "harbor-dockerhubproxy"}]}'</code></p>
<p><code>kubectl patch deployment k8s-sample-app -p '{"metadata":{"labels":{"demo":"yes"}}}'</code></p>
<p>jenže co když chceme postupně přidávat více (přes CLI)?
- json: <code>kubectl patch serviceaccount default -p '{"imagePullSecrets": [{"name": "harbor-amor"}, {"name": "harbor-dockerhubproxy"}]}'</code></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              20/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-21">
          <div class="inner">
            
            <header><h1>kubectl patch (2)</h1></header>
            
            
            <section><ul>
<li>
<p>patch file: <code>kubectl patch serviceaccount default --patch-file ...</code></p>
<pre><code>imagePullSecrets:
- harbor-amor
- harbor-dockerhubproxy
</code></pre>
<ul>
<li>type=json:</li>
</ul>
<p>kubectl patch nodes worker04 worker05 \
  --type=json -p='[{"op": "add", "path": "/metadata/labels/demo", "value": "yes"}]'</p>
<p>kubectl patch nodes worker04 worker05 \
  --type=json -p='[{"op": "remove", "path": "/metadata/labels/demo"}]'</p>
</li>
</ul>
<p>...nebo dohromady:</p>
<pre><code>  kubectl patch nodes worker04 worker05 \
  --type=json -p='[
    {"op": "add", "path": "/metadata/labels/demo", "value": "yes"},
    {"op": "remove", "path": "/metadata/labels/xxx", "value": "yes"}
  ]'
</code></pre>
<p><a href="https://kubernetes.io/docs/tasks/manage-kubernetes-objects/update-api-object-kubectl-patch/">https://kubernetes.io/docs/tasks/manage-kubernetes-objects/update-api-object-kubectl-patch/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              21/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-22">
          <div class="inner">
            
            <header><h1>Zabezpečení ingresu pomocí TLS</h1></header>
            
            
            <section><ul>
<li>TLS secrety - viz entry app (ukázka vytvoření TLS secretu)</li>
<li>Registry secrety</li>
<li>generické secrety</li>
</ul>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
              <p>projit ingress + tls secret entry-app</p>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              22/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-23">
          <div class="inner">
            
            <header><h1>Labels &amp; selectors, node selectors</h1></header>
            
            
            <section><ul>
<li>label je prostá nálepka</li>
<li>selectory jsou filtry</li>
</ul>

<p><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
              <p>ukazat na examples/ha - je tam selector i nodeSelector, dal ukazat i cli --selector</p>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              23/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_code slide-24">
          <div class="inner">
            
            <header><h1>Taints, tolerations (1)</h1></header>
            
            
            <section><p><code>kubectl taint nodes node1 key1=value1:NoSchedule</code></p>
<p><code>kubectl taint nodes node1 key1=value1:NoSchedule-</code></p>
<div class="highlight"><pre><span></span><span class="nt">tolerations</span><span class="p">:</span><span class="w"></span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;key1&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Equal&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value1&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NoSchedule&quot;</span><span class="w"></span>

<span class="nt">tolerations</span><span class="p">:</span><span class="w"></span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;key1&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Equal&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value1&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NoExecute&quot;</span><span class="w"></span>

<span class="kt">!yaml</span><span class="w"></span>
<span class="nt">tolerations</span><span class="p">:</span><span class="w"></span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;key1&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Exists&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NoSchedule&quot;</span><span class="w"></span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              24/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-25">
          <div class="inner">
            
            <header><h1>Taints, tolerations (2)</h1></header>
            
            
            <section><p><code>kubectl describe nodes | egrep -hi "Taint|Hostname"</code></p>
<p><code>kubectl get nodes -o custom-columns=NAME:.metadata.name,TAINTS:.spec.taints --no-headers</code></p>
<p><a href="https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/">https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              25/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-26">
          <div class="inner">
            
            <header><h1>High-availability, pod disruption budget (příprava 1)</h1></header>
            
            
            <section><p>1) nejprve vyčistit 2 nody (vysvětlit):</p>
<pre><code>      kubectl patch nodes worker04 worker05 -p '{"spec":{"taints": null}}'
      kubectl patch nodes worker04 worker05 --type=json -p='[{"op": "remove", "path": "/metadata/labels/demo"}]'

      kubectl taint node worker04 demo=pdb-test:NoExecute
      kubectl taint node worker05 demo=pdb-test:NoExecute
      kubectl taint node worker05 demo=pdb-test:NoSchedule
</code></pre>
<p>2) přidat label <code>demo=yes</code> oběma nodům (třeba přes patch)</p>
<pre><code>- `kubectl patch nodes worker04 worker05 --type=json -p='[{"op": "add", "path": "/metadata/labels/demo", "value": "yes"}]'`

- zkontrolovat přes --selector
</code></pre></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              26/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-27">
          <div class="inner">
            
            <header><h1>High-availability, pod disruption budget (příprava 2)</h1></header>
            
            
            <section><p>3) nodeSelector -&gt; node label demo=yes
    - na oba nody
    - nasadit deployment
    - naškálovat na 2 repliky</p>
<p>4) dodat toleration do deploymentu:</p>
<pre><code>      tolerations:
      - key: "demo"
        operator: "Equal"
        value: "pdb-test"
        effect: "NoExecute"

  cílem je dostat pody jen na worker04
</code></pre>
<p>5) osdtranit taint NoSchedule (proč?)</p>
<p>6) předvést drain worker04 při zapnuté curl smyčce (app-client)</p>
<pre><code>      while true; do
        curl http://k8s-sample-app/ready
        cat /proc/uptime|awk '{print $1}'
        sleep 0.1
      done
</code></pre></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              27/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-28">
          <div class="inner">
            
            <header><h1>High-availability, pod disruption budget</h1></header>
            
            
            <section><p><code>kubectl create poddisruptionbudget k8s-sample-app-pdb --selector=app=k8s-sample-app --min-available=2</code></p>
<ul>
<li>app-client + skript</li>
<li>drain bez PDB</li>
<li>drain s PDB</li>
</ul>
<p><a href="https://kubernetes.io/docs/tasks/run-application/configure-pdb/">https://kubernetes.io/docs/tasks/run-application/configure-pdb/</a>
<a href="https://kubernetes.io/docs/concepts/workloads/pods/disruptions/">https://kubernetes.io/docs/concepts/workloads/pods/disruptions/</a></p>
<p>POZOR! PDB nefunguje v případech <strong>taint-based eviction</strong> (vysvětlit a ukázat)</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              28/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-29">
          <div class="inner">
            
            <header><h1>Horizontal pod autoscaler</h1></header>
            
            
            <section><p><code>kubectl autoscale deployment k8s-sample-app --min=1 --max=3 --cpu-percent=50</code></p>
<p>load:</p>
<p><code>kubectl run -i --tty load-generator --rm --image=harbor.trask.cz/arm64/ubuntu-netcat --restart=Never -- /bin/sh -c "while sleep 0.01; do curl -s --connect-timeout 2 --max-time 2 http://10.4.61.4; done"</code></p>
<p><a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/">https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/</a>
<a href="https://v1-25.docs.kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/">https://v1-25.docs.kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              29/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-30">
          <div class="inner">
            
            <header><h1>Cordon, drain</h1></header>
            
            
            <section><ul>
<li>cordon: zamezení plánování na takto označený node</li>
<li>drain: "vypuštění" node před údržbou (nebo při vyčerpání zdrojů)</li>
<li>
<p>při drain se automaticky provede cordon:</p>
<p><code>kubectl drain worker05 --ignore-daemonsets --delete-local-data</code></p>
<p><code>watch -n 1 curl -s --connect-timeout 2 --max-time 2 http://10.4.61.4</code></p>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              30/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-31">
          <div class="inner">
            
            <header><h1>Custom Resource Definition (CRD)</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              31/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-32">
          <div class="inner">
            
            <header><h1>Resource quota</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              32/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-33">
          <div class="inner">
            
            <header><h1>Resource limit</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              33/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-34">
          <div class="inner">
            
            <header><h1>Kubernetes best practices -&gt; Helm Charts</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              34/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-35">
          <div class="inner">
            
            <header><h1>Autentifikace, uživatelské a servisní účty</h1></header>
            
            
            <section><p>https://kubernetes-tutorial.schoolofdevops.com/configuring_authentication_and_authorization/</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              35/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-36">
          <div class="inner">
            
            <header><h1>Container registry - autentifikace</h1></header>
            
            
            <section>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
              <p>default/docker-registry-harbor</p><p>objasnit princip sa + registry secret</p>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              36/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-37">
          <div class="inner">
            
            <header><h1>Multiplatformní přístupy (ARM64)</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              37/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-38">
          <div class="inner">
            
            <header><h1>Diskuse</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              38/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-39">
          <div class="inner">
            
            <header><h1>Přestávka</h1></header>
            
            
            <section>
<p><img alt="docker-vs-vm" src="file:///home/amoravek/projects/trask/k8s-skoleni/git/k8s/presentation/k8s-2/../common/coffee.jpg" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [15 min]
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              39/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-40">
          <div class="inner">
            
            <header><h1>Přestávka na oběd</h1></header>
            
            
            <section>
<p><img alt="obed" src="file:///home/amoravek/projects/trask/k8s-skoleni/git/k8s/presentation/k8s-2/../common/open.knedliky.jpg" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [30 min - 1 h] 
            
            
            <aside class="source">
              Source: <a href="presentation.md">presentation.md</a>
            </aside>
            
            <aside class="page_number">
              40/40
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source:  -->
      <div class="slide-wrapper">
        <div class="slide slide-">
          <div class="inner">
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="page_number">
              /40
            </aside>
          </footer>
        </div>
      </div>
      
    </div>
  </div>
  
  <div id="toc" class="sidebar hidden">
    <h2>Table of Contents</h2>
    <table>
      <caption>Table of Contents</caption>

<!-- macro for generating subsection of TOC -->

<!-- end of macro -->

      <!-- generating sections of TOC -->
      
      <tr id="toc-row-1">
        <th><a href="#slide:1">Kubernetes II.</a></th>
        <td><a href="#slide:1">1</a></td>
      </tr>
      
      
      <tr id="toc-row-2">
        <th><a href="#slide:2">Requests, limits v k9s</a></th>
        <td><a href="#slide:2">2</a></td>
      </tr>
      
      
      <tr id="toc-row-3">
        <th><a href="#slide:3">kubectl ... -o jsonpath</a></th>
        <td><a href="#slide:3">3</a></td>
      </tr>
      
      
      <tr id="toc-row-4">
        <th><a href="#slide:4">Autentizace - pokračování</a></th>
        <td><a href="#slide:4">4</a></td>
      </tr>
      
      
      <tr id="toc-row-5">
        <th><a href="#slide:5">Autentizace - x509</a></th>
        <td><a href="#slide:5">5</a></td>
      </tr>
      
      
      <tr id="toc-row-6">
        <th><a href="#slide:6">Autentizace - bootstrap tokens</a></th>
        <td><a href="#slide:6">6</a></td>
      </tr>
      
      
      <tr id="toc-row-7">
        <th><a href="#slide:7">Autentizace - bootstrap tokens (příklady)</a></th>
        <td><a href="#slide:7">7</a></td>
      </tr>
      
      
      <tr id="toc-row-8">
        <th><a href="#slide:8">Autentizace - Service Account Tokens</a></th>
        <td><a href="#slide:8">8</a></td>
      </tr>
      
      
      <tr id="toc-row-9">
        <th><a href="#slide:9">OpenID Connect</a></th>
        <td><a href="#slide:9">9</a></td>
      </tr>
      
      
      <tr id="toc-row-10">
        <th><a href="#slide:10">kubeconfigy (kdo nemá)</a></th>
        <td><a href="#slide:10">10</a></td>
      </tr>
      
      
      <tr id="toc-row-11">
        <th><a href="#slide:11">RBAC (Role-Based Access Control)</a></th>
        <td><a href="#slide:11">11</a></td>
      </tr>
      
      
      <tr id="toc-row-12">
        <th><a href="#slide:12">RBAC - cvičení 1</a></th>
        <td><a href="#slide:12">12</a></td>
      </tr>
      
      
      <tr id="toc-row-13">
        <th><a href="#slide:13">Řešení</a></th>
        <td><a href="#slide:13">13</a></td>
      </tr>
      
      
      <tr id="toc-row-14">
        <th><a href="#slide:14">RBAC - cvičení 2</a></th>
        <td><a href="#slide:14">14</a></td>
      </tr>
      
      
      <tr id="toc-row-15">
        <th><a href="#slide:15">Řešení</a></th>
        <td><a href="#slide:15">15</a></td>
      </tr>
      
      
      <tr id="toc-row-16">
        <th><a href="#slide:16">Readiness a Liveness probes - pokračování</a></th>
        <td><a href="#slide:16">16</a></td>
      </tr>
      
      
      <tr id="toc-row-17">
        <th><a href="#slide:17">Hledání problémů</a></th>
        <td><a href="#slide:17">17</a></td>
      </tr>
      
      
      <tr id="toc-row-18">
        <th><a href="#slide:18">LimitRange</a></th>
        <td><a href="#slide:18">18</a></td>
      </tr>
      
      
      <tr id="toc-row-19">
        <th><a href="#slide:19">ResourceQuota</a></th>
        <td><a href="#slide:19">19</a></td>
      </tr>
      
      
      <tr id="toc-row-20">
        <th><a href="#slide:20">kubectl patch (1)</a></th>
        <td><a href="#slide:20">20</a></td>
      </tr>
      
      
      <tr id="toc-row-21">
        <th><a href="#slide:21">kubectl patch (2)</a></th>
        <td><a href="#slide:21">21</a></td>
      </tr>
      
      
      <tr id="toc-row-22">
        <th><a href="#slide:22">Zabezpečení ingresu pomocí TLS</a></th>
        <td><a href="#slide:22">22</a></td>
      </tr>
      
      
      <tr id="toc-row-23">
        <th><a href="#slide:23">Labels &amp; selectors, node selectors</a></th>
        <td><a href="#slide:23">23</a></td>
      </tr>
      
      
      <tr id="toc-row-24">
        <th><a href="#slide:24">Taints, tolerations (1)</a></th>
        <td><a href="#slide:24">24</a></td>
      </tr>
      
      
      <tr id="toc-row-25">
        <th><a href="#slide:25">Taints, tolerations (2)</a></th>
        <td><a href="#slide:25">25</a></td>
      </tr>
      
      
      <tr id="toc-row-26">
        <th><a href="#slide:26">High-availability, pod disruption budget (příprava 1)</a></th>
        <td><a href="#slide:26">26</a></td>
      </tr>
      
      
      <tr id="toc-row-27">
        <th><a href="#slide:27">High-availability, pod disruption budget (příprava 2)</a></th>
        <td><a href="#slide:27">27</a></td>
      </tr>
      
      
      <tr id="toc-row-28">
        <th><a href="#slide:28">High-availability, pod disruption budget</a></th>
        <td><a href="#slide:28">28</a></td>
      </tr>
      
      
      <tr id="toc-row-29">
        <th><a href="#slide:29">Horizontal pod autoscaler</a></th>
        <td><a href="#slide:29">29</a></td>
      </tr>
      
      
      <tr id="toc-row-30">
        <th><a href="#slide:30">Cordon, drain</a></th>
        <td><a href="#slide:30">30</a></td>
      </tr>
      
      
      <tr id="toc-row-31">
        <th><a href="#slide:31">Custom Resource Definition (CRD)</a></th>
        <td><a href="#slide:31">31</a></td>
      </tr>
      
      
      <tr id="toc-row-32">
        <th><a href="#slide:32">Resource quota</a></th>
        <td><a href="#slide:32">32</a></td>
      </tr>
      
      
      <tr id="toc-row-33">
        <th><a href="#slide:33">Resource limit</a></th>
        <td><a href="#slide:33">33</a></td>
      </tr>
      
      
      <tr id="toc-row-34">
        <th><a href="#slide:34">Kubernetes best practices -&gt; Helm Charts</a></th>
        <td><a href="#slide:34">34</a></td>
      </tr>
      
      
      <tr id="toc-row-35">
        <th><a href="#slide:35">Autentifikace, uživatelské a servisní účty</a></th>
        <td><a href="#slide:35">35</a></td>
      </tr>
      
      
      <tr id="toc-row-36">
        <th><a href="#slide:36">Container registry - autentifikace</a></th>
        <td><a href="#slide:36">36</a></td>
      </tr>
      
      
      <tr id="toc-row-37">
        <th><a href="#slide:37">Multiplatformní přístupy (ARM64)</a></th>
        <td><a href="#slide:37">37</a></td>
      </tr>
      
      
      <tr id="toc-row-38">
        <th><a href="#slide:38">Diskuse</a></th>
        <td><a href="#slide:38">38</a></td>
      </tr>
      
      
      <tr id="toc-row-39">
        <th><a href="#slide:39">Přestávka</a></th>
        <td><a href="#slide:39">39</a></td>
      </tr>
      
      
      <tr id="toc-row-40">
        <th><a href="#slide:40">Přestávka na oběd</a></th>
        <td><a href="#slide:40">40</a></td>
      </tr>
      
      
    </table>
  </div>
  
  <div id="help" class="sidebar hidden">
    <h2>Help</h2>
    <table>
      <caption>Help</caption>
      <tr>
        <th>Table of Contents</th>
        <td>t</td>
      </tr>
      <tr>
        <th>Exposé</th>
        <td>ESC</td>
      </tr>
      <tr>
        <th>Presenter View</th>
        <td>p</td>
      </tr>
      <tr>
        <th>Source Files</th>
        <td>s</td>
      </tr>
      <tr>
        <th>Slide Numbers</th>
        <td>n</td>
      </tr>
      <tr>
        <th>Toggle screen blanking</th>
        <td>b</td>
      </tr>
      <tr>
        <th>Show/hide next slide</th>
        <td>c</td>
      </tr>
      <tr>
        <th>Notes</th>
        <td>2</td>
      </tr>
      <tr>
        <th>Help</th>
        <td>h</td>
      </tr>
    </table>
    <br>
    <strong>Generated with Darkslide 6.0.0</strong>
  </div>
  <script>main()</script>
</body>
</html>