<!DOCTYPE html>
<!--
  Copyright 2010 Google Inc.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

  Original slides: Marcin Wichary (mwichary@google.com)
  Modifications: Ernest Delgado (ernestd@google.com)
                 Alex Russell (slightlyoff@chromium.org)

  landslide modifications: Adam Zapletal (adamzap@gmail.com)
                           Nicolas Perriault (nperriault@gmail.com)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Docker</title>
    <!-- Styles -->
    
    <link rel="stylesheet" href="file:///usr/lib/python3/dist-packages/darkslide/themes/default/css/base.css">
    <link rel="stylesheet" media="print" href="file:///usr/lib/python3/dist-packages/darkslide/themes/default/css/print.css">
    <link rel="stylesheet" media="screen, projection" href="file:///usr/lib/python3/dist-packages/darkslide/themes/default/css/screen.css">
    <link rel="stylesheet" media="all" href="file:///usr/lib/python3/dist-packages/darkslide/themes/default/css/theme.css">
    
    
    <!-- /Styles -->
    <!-- Javascripts -->
    
    <script type="text/javascript" src="file:///usr/lib/python3/dist-packages/darkslide/themes/default/js/slides.js"></script>
    
    
    <!-- /Javascripts -->
</head>
<body>
  <div id="blank"></div>
  <div class="presentation">
    <div id="current_presenter_notes">
      <div id="presenter_note"></div>
    </div>
    <div class="slides">
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-1">
          <div class="inner">
            
            <header><h1>Docker</h1></header>
            
            
            <section><p>Online poznámky: <a href="https://codimd.trask.cz/s/rJPCa8C0v">https://codimd.trask.cz/s/rJPCa8C0v</a></p>
<p>Adam Morávek, amoravek@trask.cz, +420 724 514 916</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              1/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-2">
          <div class="inner">
            
            <header><h1>Co to je Docker?</h1></header>
            
            
            <section>
<h1>...je to nástroj, který umožňuje:</h1>
<ul>
<li>vytvořit artefakt schopný běhu všude tam, kde je Docker runtime</li>
<li>zapouzdřit aplikaci včetně jejího prostředí</li>
<li>redukovat problémy při nasazování aplikací</li>
<li>řešit podobné úlohy jako VM</li>
</ul>


<h1></h1>
<h1></h1>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
              <p>zminit napr. komplexitu nasazeni webapp na vice AS, vice OS, apod.</p><p>redukce problemu = redukuje pacive problemy dneska, prinasi ale nove (nova tech.)</p>
            
            </section>
          </div>
          <footer>
            
              Základy Docker a Kubernetes 01/2021
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              2/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-3">
          <div class="inner">
            
            <header><h1>Srovnání s VM</h1></header>
            
            
            <section>
<p><img alt="docker-vs-vm" src="file:///home/amoravek/projects/trask/k8s-skoleni/git/k8s/presentation/docker/docker-vs-vm.png" /></p>

</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
              <p>zmínit prakticky okamžité spuštění oproti nutnosti bootu VM</p><p>zmínit řádové snížení velikosti image oproti VM</p>
            
            </section>
          </div>
          <footer>
            
              [5 min]
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              3/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-4">
          <div class="inner">
            
            <header><h1>Linux kernel</h1></header>
            
            
            <section>
<ul>
<li>Docker je produkt založený na vlastnostech a funkcích jádra <strong>Linuxu</strong></li>
<li>nefunguje nativně např. na AIX, Windows ani macOS (jen s virtualizační mezivrstvou nebo s plnohodnotným Linuxem jako součástí OS)</li>
<li>všechny kontejnery (viz dále) sdílí s host OS jeho linux kernel</li>
<li>kontejnery nejsou nic jiného než běžné procesy uzavřené do vlastního namespace a se zdroji omezenými za pomocí control groups (obojí funkce linuxového jádra)</li>
<li>kontejner tedy není žádný "aktivní obal", ale jen logicky izolovaný proces, který se tváří jako samostatná VM</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min]
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              4/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-5">
          <div class="inner">
            
            <header><h1>Motivace</h1></header>
            
            
            <section>
<ul>
<li>distribuce neměnného balíčku (=docker image) k zákazníkovi</li>
<li>image se nedají měnit, ale může se z nich <em>dědit</em></li>
<li>docker image obsahuje vše potřebné pro spuštění aplikace</li>
<li>image lze digitálně podepsat</li>
<li>součástí image i kompletní souborový systém OS - např. OS CVE lze řešit rebuildem image</li>
<li>image se verzují</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min]
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              5/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_code has_footer slide-6">
          <div class="inner">
            
            <header><h1>Image</h1></header>
            
            
            <section>
<h2>Co je vlastně image?</h2>
<ul>
<li>lze si představit jako .tar.gz souborového systému OS + nějaká metadata</li>
<li><em>image</em> je vždy read-only, vytváří se <em>buildem</em></li>
<li>image se většinou zakládá na nějakém již existujícím - např. JDK image dědí z Alpine linux image a dodá instalaci JDK</li>
</ul>
<h1></h1>
<div class="highlight"><pre><span></span><span class="lineno">1 </span><span class="k">FROM</span><span class="s"> alpine</span>
<span class="lineno">2 </span><span class="k">RUN</span> &lt;instalace jdk&gt;
</pre></div>

<h1></h1>
<p>(je to něco jako vzít souborový systém Alpine linuxu, nakopírovat tam JDK, zazipovat a obalit metadaty)</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              6/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_code has_footer slide-7">
          <div class="inner">
            
            <header><h1>Parent a base image</h1></header>
            
            
            <section>
<ul>
<li>parent image referencován instrukcí <code>FROM</code></li>
<li>parent images dostupné např. na Docker HUB</li>
<li>kde je ale root image? Je to image s <code>FROM scratch</code>, ale častěji se vytváří importem zazipovaného souborového systému:</li>
</ul>


<h1></h1>
<div class="highlight"><pre><span></span><span class="lineno"> 1 </span>$ sudo debootstrap xenial xenial &gt; /dev/null
<span class="lineno"> 2 </span>$ sudo tar -C xenial -c . <span class="p">|</span> docker import - xenial
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span>a29c15f1bf7a
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span>$ docker run xenial cat /etc/lsb-release
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span><span class="nv">DISTRIB_ID</span><span class="o">=</span>Ubuntu
<span class="lineno"> 9 </span><span class="nv">DISTRIB_RELEASE</span><span class="o">=</span><span class="m">16</span>.04
<span class="lineno">10 </span><span class="nv">DISTRIB_CODENAME</span><span class="o">=</span>xenial
<span class="lineno">11 </span><span class="nv">DISTRIB_DESCRIPTION</span><span class="o">=</span><span class="s2">&quot;Ubuntu 16.04 LTS&quot;</span>
</pre></div>

<h1></h1>
<h1></h1></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
              <p>zmínit absenci init</p><p>scratch je rezervovaný název - prázdný parent image</p>
            
            </section>
          </div>
          <footer>
            
              [5 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              7/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-8">
          <div class="inner">
            
            <header><h1>Kontejner</h1></header>
            
            
            <section>
<ul>
<li><em>kontejner</em> je vlastní aktivní proces spuštěný nad souborovým systémem z image (lze si představit jako <em>instanci</em> image)</li>
<li>spuštění kontejneru s aplikací = spuštění procesu aplikace na systému, kde běží Docker daemon, ale proces je izolován ve vlastním <em>namespace</em> a běží jako root proces (PID 1)</li>
<li>root procesem host OS je zpravidla initd nebo systemd - kontejner init proces nemá, protože nebootuje, začíná přímo spuštěním procesu</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              8/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-9">
          <div class="inner">
            
            <header><h1>Docker daemon</h1></header>
            
            
            <section>
<ul>
<li>proces běžící na pozadí</li>
<li>spravuje Docker objekty (image, kontejnery, síť, úložiště)</li>
<li>občas je potřeba změnit konfiguraci: /etc/docker/daemon.json (typicky kvůli insecure registry)</li>
<li>musí běžet jako root - často terčem kritiky (v kombinaci s root právy uživatele v kontejneru)</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              9/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-10">
          <div class="inner">
            
            <header><h1>OCI</h1></header>
            
            
            <section>
<ul>
<li>Open Container Initiative</li>
<li>představuje otevřený standard rozhraní container runtime a formátu image</li>
<li>díky OCI mohlo Kubernetes opustit docker daemon a přejít na containerd</li>
<li>vzhledem k raketovému rozvoji kontejnerizace je OCI nutnost</li>
<li>mezi OCI-compliant runtime patří např. docker, cri-o a containerd (docker již ale interně používá containderd)</li>
</ul>
<h1></h1></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              10/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-11">
          <div class="inner">
            
            <header><h1>Docker CLI</h1></header>
            
            
            <section>
<ul>
<li>základní (a naprosto dostačující) utilita pro vytváření, správu a manipulaci s docker objekty</li>
<li>build image: <code>docker build -t myimage:1.0</code> .</li>
<li>spuštění kontejneru: <code>docker run -d -name mycont1 -p 8088:8080 myimage:1.0</code></li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              11/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-12">
          <div class="inner">
            
            <header><h1>Dockerfile</h1></header>
            
            
            <section>
<ul>
<li>textový soubor obsahující instrukce pro build image</li>
<li>proprietární formát</li>
<li>pokud není určeno jinak, předpokládá se název <code>Dockerfile</code></li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              12/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_code has_footer slide-13">
          <div class="inner">
            
            <header><h1>Příklad (1)</h1></header>
            
            
            <section>
<p>(examples/docker-simple)</p>
<div class="highlight"><pre><span></span><span class="lineno">1 </span><span class="k">FROM</span><span class="s"> nginx:alpine</span>
<span class="lineno">2 </span><span class="k">COPY</span> . /usr/share/nginx/html
</pre></div>


<p>Vytvoříme image: <code>docker build -t docker-simple:0.1 .</code>
Spustíme: <code>docker run -ti --rm -p 8881:80 docker-simple:0.1</code></p>
<p><code>docker &lt;group&gt; [options] &lt;image&gt; [command]</code></p>
<p>http://localhost:8881</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
              <p>objasnit nginx:alpine</p>
            
            </section>
          </div>
          <footer>
            
              [5 min]
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              13/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-14">
          <div class="inner">
            
            <header><h1>Příklad (2)</h1></header>
            
            
            <section><p>Zastavíme kontejner (běží na popředí): Ctrl+C (pošle SIGINT, ne SIGKILL)</p>
<p>Spustíme na pozadí: <code>docker run -d --name docker-simple -p 8881:80 docker-simple:0.1</code></p>
<p>Ověříme, že běží:</p>
<ul>
<li>docker ps</li>
<li>docker logs -f docker-simple</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min]
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              14/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_code has_footer slide-15">
          <div class="inner">
            
            <header><h1>Příklad (3)</h1></header>
            
            
            <section><p>Prozkoumáme kontejner (pocitově jsme už <em>jako kdyby</em> ve VM):</p>
<ul>
<li><code>docker exec -ti docker-simple sh</code></li>
<li><code>cd /usr/share/nginx/html</code></li>
<li><code>ls -l</code>:<div class="highlight"><pre><span></span><span class="lineno">1 </span>50x.html    Dockerfile  build.sh    index.html
</pre></div>

</li>
</ul>
<p>Pokusy:</p>
<ul>
<li><code>hostname</code></li>
<li><code>ps</code></li>
<li><code>ls -la /</code></li>
<li><code>uname -a</code></li>
<li><code>cat /etc/*release</code></li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min]
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              15/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-16">
          <div class="inner">
            
            <header><h1>Příklad (4)</h1></header>
            
            
            <section><p>Uklidíme:</p>
<ul>
<li><code>exit</code></li>
<li><code>docker ps</code></li>
<li><code>docker stop/kill docker-simple</code></li>
<li><code>docker ps -a</code></li>
<li><code>docker rm/rm -f docker-simple</code></li>
<li><code>docker ps -a</code></li>
</ul>
<p>...a nikde nic...EPHEMERAL! :-)</p>
<p>(pozor, spolu s kontejnerem zmizí i vše, co vyprodukoval, pokud neprodukoval na VOLUME)</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min]
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              16/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_code has_footer slide-17">
          <div class="inner">
            
            <header><h1>docker kontext</h1></header>
            
            
            <section>
<p>...vraťme se ještě na slide <strong><a href="#slide:14">Příklad (3)</a></strong>: co tam dělá Dockerfile a build.sh???</p>
<p>Chtěli jsme to přece: <code>COPY . /usr/share/nginx/html</code></p>
<p>Řešení je snadné - filtrace kontextu pomocí <code>.dockerignore</code> (obdoba .gitignore) - např.:</p>
<div class="highlight"><pre><span></span><span class="lineno">1 </span>.git
<span class="lineno">2 </span>.cache
<span class="lineno">3 </span>target
<span class="lineno">4 </span>**/*.class
<span class="lineno">5 </span>*.md
<span class="lineno">6 </span>!README.md
</pre></div>

<p>...a pro náš příklad:</p>
<div class="highlight"><pre><span></span><span class="lineno">1 </span>*.sh
<span class="lineno">2 </span>Dockerfile*
</pre></div>

<p>Zkusme tedy nový build...   </p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              17/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-18">
          <div class="inner">
            
            <header><h1>Přestávka do 10:45</h1></header>
            
            
            <section>
<p><img alt="docker-vs-vm" src="file:///home/amoravek/projects/trask/k8s-skoleni/git/k8s/presentation/docker/../common/coffee.jpg" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [15 min]
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              18/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-19">
          <div class="inner">
            
            <header><h1>Dockerfile - příkazy (1)</h1></header>
            
            
            <section>
<p>Inspirace: <a href="https://repogit.trask.cz/git/BI_Docker">https://repogit.trask.cz/git/BI_Docker</a></p>
<p>Vybrané příkazy:</p>
<ul>
<li><a href="https://docs.docker.com/engine/reference/builder/#from"><code>FROM</code></a></li>
<li><a href="https://docs.docker.com/engine/reference/builder/#add"><code>ADD</code></a></li>
<li><a href="https://docs.docker.com/engine/reference/builder/#copy"><code>COPY</code></a></li>
<li><a href="https://docs.docker.com/engine/reference/builder/#run"><code>RUN</code></a></li>
<li><a href="https://docs.docker.com/engine/reference/builder/#user"><code>USER</code></a></li>
<li><a href="https://docs.docker.com/engine/reference/builder/#workdir"><code>WORKDIR</code></a></li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [15 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              19/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-20">
          <div class="inner">
            
            <header><h1>Dockerfile - příkazy (2)</h1></header>
            
            
            <section><ul>
<li><a href="https://docs.docker.com/engine/reference/builder/#expose"><code>EXPOSE</code></a></li>
<li><a href="https://docs.docker.com/engine/reference/builder/#volume"><code>VOLUME</code></a></li>
<li><a href="https://docs.docker.com/engine/reference/builder/#entrypoint"><code>ENTRYPOINT</code></a></li>
<li><a href="https://docs.docker.com/engine/reference/builder/#cmd"><code>CMD</code></a></li>
<li><a href="https://docs.docker.com/engine/reference/builder/#env"><code>ENV</code></a></li>
<li><a href="https://docs.docker.com/engine/reference/builder/#arg"><code>ARG</code></a></li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [15 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              20/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-21">
          <div class="inner">
            
            <header><h1>PID 1, exec vs shell formy</h1></header>
            
            
            <section>
<p>Existence kontejneru je přímo spojena s životem procesu s PID 1.</p>
<p>Rozdíl mezi:</p>
<ul>
<li>ENTRYPOINT "/app/bin/your-app arg1 arg2" (shell-form)</li>
<li>ENTRYPOINT ["/app/bin/your-app", "arg1", "arg2"] (exec-form)</li>
</ul>
<p>Pěkně vysvětleno: <a href="https://hynek.me/articles/docker-signals/">https://hynek.me/articles/docker-signals/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [25 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              21/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-22">
          <div class="inner">
            
            <header><h1>Build a vrstvy</h1></header>
            
            
            <section>
<ul>
<li>Každý příkaz v rámci Dockerfile = vrstva v souborovém systému</li>
<li>vrstvy jsou read-only, zápisová je jen ta "vrchní"</li>
<li>copy-on-write</li>
<li>vhodná organizace vrstev tak, aby je nebylo nutné zbytečně buildovat/stahovat</li>
</ul>
<p>Příklad buildu + push, pull (docker-images/mdr) + porovnat rychlosti při změnách</p>
<p>Dokumentace: <a href="https://docs.docker.com/storage/storagedriver/">https://docs.docker.com/storage/storagedriver/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [10 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              22/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_code has_footer slide-23">
          <div class="inner">
            
            <header><h1>Multi-stage build</h1></header>
            
            
            <section>
<ul>
<li>složitý build může zanechat spoustu nepotřebných dat (i když si dáme pozor)</li>
<li>
<p>jednodušší je provést např. maven build někde jinde (v nějakém jiném kontejneru) a pak jen zkopírovat výsledný artefakt:</p>
<div class="highlight"><pre><span></span><span class="lineno">1 </span><span class="k">FROM</span><span class="s"> alpine AS builder</span>
<span class="lineno">2 </span>&lt;nějaký build&gt;
<span class="lineno">3 </span>&lt;artefakt uložen <span class="k">do</span> /git/app/target/app.jar&gt;
<span class="lineno">4 </span><span class="k">FROM</span><span class="s"> centos:8</span>
<span class="lineno">5 </span><span class="k">COPY</span> --from builder /git/app/target/app.jar /deployments/
<span class="lineno">6 </span>...
</pre></div>

</li>
<li>
<p>builder image je po použití smazán (nevytvoří se image, ale zůstávají vrstvy)</p>
</li>
<li>je možné použít už existující image a jen zkopírovat data</li>
</ul>
<p><a href="https://docs.docker.com/develop/develop-images/multistage-build/">https://docs.docker.com/develop/develop-images/multistage-build/</a></p>
<p>Příklad s ta:1.1.10 image - porovnat výslednou velikost</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [20 min]
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              23/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-24">
          <div class="inner">
            
            <header><h1>Názvy images, Docker repository</h1></header>
            
            
            <section>
<p>Název image: <code>[host:port/]&lt;repository1&gt;/&lt;repository2&gt;/.../&lt;image-name&gt;[:&lt;image-version&gt;]</code></p>
<p>Např.:</p>
<ul>
<li>trask/tif/mdr:3.1.21</li>
<li>harbor.trask.cz/arm64/keycloak:12.0.1</li>
<li>localhost:5000/redis</li>
</ul>
<p>Pokud chybí verze image, použije se <code>latest</code> (má nevýhody)</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              24/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-25">
          <div class="inner">
            
            <header><h1>Docker registry</h1></header>
            
            
            <section><ul>
<li>
<p><code>[host:port/]</code> část z předchozího slidu = docker registry; pokud chybí je lokální</p>
</li>
<li>
<p>image je tedy možné ukládat kromě lokální registry i do remote registry, např:</p>
<pre><code>docker push harbor.trask.cz/arm64/keycloak:12.0.1
</code></pre>
</li>
<li>
<p>hostname a port je součástí názvu (FQN) image...i když to je divné, je to praktické (viz např. Kubernetes)</p>
</li>
<li>i remote registry používá vrstvy, což VELMI urychluje</li>
</ul>
<p>Příklad: push do remote registry, malá změna, nový push</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              25/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_code has_footer slide-26">
          <div class="inner">
            
            <header><h1>Secure/insecure</h1></header>
            
            
            <section>
<ul>
<li>registry by měla být zabezpečená ([m]TLS, login, ...)</li>
<li>insecure registry = registry nezabezpečená pomocí TLS</li>
<li>
<p>Pokud se nejedná o registry na localhostu (výjimka), Docker se s ní vůbec nebaví:</p>
<div class="highlight"><pre><span></span><span class="lineno">1 </span>Error response from daemon: Get https://:5000/v1/_ping:
<span class="lineno">2 </span>http: server gave HTTP response to HTTPS client
</pre></div>

</li>
<li>
<p>lze obejít úpravou <code>/etc/docker/daemon.json</code>:</p>
<div class="highlight"><pre><span></span><span class="lineno">1 </span><span class="p">{</span>
<span class="lineno">2 </span><span class="nt">&quot;insecure-registries&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;myregistrydomain.com:5000&quot;</span><span class="p">]</span>
<span class="lineno">3 </span><span class="p">}</span>
</pre></div>

</li>
</ul>
<p>Příklad externí insecure registry (proč je to užitečné a proč se často nezabezpečuje)</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              26/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-27">
          <div class="inner">
            
            <header><h1>harbor.trask.cz</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              27/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-28">
          <div class="inner">
            
            <header><h1>pull, push, tag, login/logout</h1></header>
            
            
            <section>
<p>Image, jeho správa a přesun do- a z registry:</p>
<ul>
<li><code>docker tag</code></li>
<li><code>docker push &lt;image spec&gt;</code></li>
<li><code>docker pull &lt;image spec&gt;</code></li>
<li><code>docker rmi</code></li>
</ul>
<p>Do registry je mnohdy nutný login:</p>
<ul>
<li>docker login</li>
<li>docker logout</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [10 min]
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              28/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-29">
          <div class="inner">
            
            <header><h1>Přestávka na oběd</h1></header>
            
            
            <section>
<p><img alt="obed" src="file:///home/amoravek/projects/trask/k8s-skoleni/git/k8s/presentation/docker/../common/open.knedliky.jpg" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [30 min - 1 h] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              29/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-30">
          <div class="inner">
            
            <header><h1>PID 1 podrobněji</h1></header>
            
            
            <section>
<p>Příklad: git/examples/exec-shell/</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [30 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              30/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-31">
          <div class="inner">
            
            <header><h1>Uživatelské účty a oprávnění uvnitř kontejneru, USER</h1></header>
            
            
            <section>
<ul>
<li>drtivá většina kontejnerů vytvořených z nějakého image na Docker HUBu používá <code>USER root</code></li>
<li>není to bezpečné - za určitých okolností takto lze získat přístup k host OS</li>
<li>v Dockerfile je možné použít libovolné množství <code>USER &lt;user&gt;[:&lt;group&gt;]</code> nebo <code>USER &lt;UID&gt;[:&lt;GID&gt;]</code></li>
<li>to, pod jakým uživatelem poběží <code>ENTRYPOINT</code> nebo <code>CMD</code> proces určuje předchozí <code>USER</code></li>
<li>uživatel nemusí předem existovat, pokud je použito UID</li>
<li>pokud není specifikována skupina nebo GID, použije se skupina <code>root</code></li>
<li>pokud není použito <code>USER</code>, znamená to root</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [15 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              31/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-32">
          <div class="inner">
            
            <header><h1>Publikace portů, EXPOSE</h1></header>
            
            
            <section>
<ul>
<li>kontejner po spuštění nepropaguje porty ven (jsou dostupné pouze interně)</li>
<li>je potřeba explicitně určit, jaký port/rozsah bude publikován ven</li>
<li>porty je třeba publikovat při vytváření kontejneru, pak už nejde (jednoduše) změnit</li>
<li>pokud je port v Dockerfile explicitně označen pomocí <code>EXPOSE</code>, je možné použí automatiku:<pre><code>docker run -d --name nginx -P nginx
</code></pre>
</li>
</ul>
<p>Příklad: docker run -dit --name app1 -p 5678:5678 hashicorp/http-echo -text "Test OK"</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [15 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              32/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-33">
          <div class="inner">
            
            <header><h1>Volumes</h1></header>
            
            
            <section>
<ul>
<li>kontejner ukládá implicitně všechna data "do sebe"</li>
<li>po sazání kontejneru (<code>docker rm</code>) přijdeme i o data</li>
<li>řešením je <code>VOLUME</code> - můžeme provést mount externího adresáře, NFS, apod.</li>
<li>
<p>dvě možnosti použití:</p>
<ul>
<li>
<p>named volume:</p>
<pre><code>docker volume create myvol1
docker run -d --name nginx -v myvol:/app nginx
</code></pre>
<p>data volume se ukládají do <code>/var/lib/docker/volumes</code></p>
</li>
<li>
<p>mount specifického adresáře z host OS: <code>docker run -d --name nginx -v /data:/app nginx</code></p>
</li>
<li>modifikátor <code>:ro</code></li>
</ul>
</li>
</ul>
<p>Příklady obou typů volume</p>
<p><a href="https://docs.docker.com/storage/volumes/">https://docs.docker.com/storage/volumes/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [15 min]
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              33/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-34">
          <div class="inner">
            
            <header><h1>Networking, komunikace mezi kontejnery</h1></header>
            
            
            <section>
<ul>
<li>kontejnery je možné připojovat do izolovaných sítí</li>
<li>výhodou je izolace a možnost DNS</li>
</ul>
<p>(ubuntu image, doinstalovat ping: <code>sudo apt install iputils-ping</code>, předvést oddědění image, kde je ping nainstalován)</p>
<pre><code>docker network create mynet
docker run -tid --name app1 --network mynet ubuntu (pak ubuntu-ping)
docker run -tid --name app2 ubuntu (pak ubuntu-ping)
docker network connect mynet app2
</code></pre></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [15 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              34/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-35">
          <div class="inner">
            
            <header><h1>Přestávka</h1></header>
            
            
            <section>
<p><img alt="docker-vs-vm" src="file:///home/amoravek/projects/trask/k8s-skoleni/git/k8s/presentation/docker/../common/coffee.jpg" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [15 min]
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              35/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-36">
          <div class="inner">
            
            <header><h1>Docker best practices</h1></header>
            
            
            <section>
<p>Projdeme <a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">https://docs.docker.com/develop/develop-images/dockerfile_best-practices/</a></p>
<p>Ukážeme si reálný projekt: ta:1.1.10</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [25 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              36/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-37">
          <div class="inner">
            
            <header><h1>Orchestrace – Docker Compose, Docker Swarm</h1></header>
            
            
            <section>
<ul>
<li>s narůstající komplexitou Docker aplikací narůstá i potřeba orchestrace kontejnerů</li>
<li>na počátku Docker Compose a Docker Swarm<ul>
<li>ukázka Compose + network</li>
</ul>
</li>
<li>v současnosti Kubernetes, ostatní ale má stále svoje místo</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              37/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-38">
          <div class="inner">
            
            <header><h1>Přidělování CPU a paměti</h1></header>
            
            
            <section>
<p>docker run -d --name app1 --cpus 2 --memory 512m ubuntu</p>
<p><a href="https://docs.docker.com/config/containers/resource_constraints/">https://docs.docker.com/config/containers/resource_constraints/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              38/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-39">
          <div class="inner">
            
            <header><h1>Kontejnerizace Java aplikace, JIB</h1></header>
            
            
            <section>
<ul>
<li>kontejnerizace existující aplikace vs nová aplikace</li>
<li>je dobré volit vhodný base image pro kontejnerizaci a snažit se o jeho minimalizaci (útočná plocha, velikost, ...)</li>
<li>z Docker HUBu brát VŽDY jen oficiální image !!!</li>
<li>pokud není jiná možnost provést build ze zdrojáků GitHubu, které alespoň nějak překontrolujeme (kukaččí kontejner)</li>
</ul>
<p><a href="https://github.com/GoogleContainerTools/jib/tree/master/jib-maven-plugin#quickstart">https://github.com/GoogleContainerTools/jib/tree/master/jib-maven-plugin#quickstart</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [55 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              39/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: docker/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-40">
          <div class="inner">
            
            <header><h1>Diskuse</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [55 min] 
            
            
            <aside class="source">
              Source: <a href="docker/presentation.md">docker/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              40/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-41">
          <div class="inner">
            
            <header><h1>Kubernetes I.</h1></header>
            
            
            <section><p>Online poznámky: <a href="https://codimd.trask.cz/s/rJPCa8C0v">https://codimd.trask.cz/s/rJPCa8C0v</a></p>
<p>Použitý cluster: <a href="https://arm.lab.trask.cz/">https://arm.lab.trask.cz/</a></p>
<p>Adam Morávek, amoravek@trask.cz, +420 724 514 916</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [55 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              41/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-42">
          <div class="inner">
            
            <header><h1>Potřeba orchestrace kontejnerů</h1></header>
            
            
            <section>
<ul>
<li>organizovat několik málo kontejnerů s jednoduchou aplikací ješte celkem jde</li>
<li>ale co dělat v momentě, kdy existuje celý ekosystém kontejnerů se specifickými potřebami na:<ul>
<li>dostupnost</li>
<li>propustnost</li>
<li>bezpečnost</li>
<li>spravovatelnost</li>
<li>škálování</li>
<li>a mnohé další?</li>
</ul>
</li>
<li>je nevyhnutelné, aby existoval nástroj, který jednotnou cestou řeší tyto a mnohé další potřeby</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min]
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              42/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-43">
          <div class="inner">
            
            <header><h1>Kubernetes</h1></header>
            
            
            <section>
<ul>
<li>zavádí <strong>deklarativní</strong> přístup ke správě kontejnerizovaných aplikací</li>
<li>v současné době jediná platforma, která dává dlouhodobý smysl jako cílová platforma pro kontejnerizované aplikace (můj osobní názor)</li>
<li>snadno rozšiřitelný a modulární</li>
<li>přenositelný téměř na jakýkoliv HW (viz https://arm.lab.trask.cz)</li>
<li>velmi dobře navržený</li>
<li>velmi dobře testovaný</li>
<li>velmi dobře <strong><em>zdokumentovaný</em></strong></li>
<li>bohužel ale...<strong>velmi složitý</strong></li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min]
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              43/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-44">
          <div class="inner">
            
            <header><h1>Příklad deklarativního způsobu konfigurace (YAML)</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
              <p>entry-backend</p>
            
            </section>
          </div>
          <footer>
            
              [5 min]
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              44/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-45">
          <div class="inner">
            
            <header><h1>Architektura Kubernetes (1)</h1></header>
            
            
            <section>
<p><img alt="file:///home/amoravek/projects/trask/k8s-skoleni/git/k8s/presentation/k8s-1/k8s-arch.png" src="file:///home/amoravek/projects/trask/k8s-skoleni/git/k8s/presentation/k8s-1/k8s-arch.png" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [10 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              45/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-46">
          <div class="inner">
            
            <header><h1>Architektura Kubernetes (2)</h1></header>
            
            
            <section><ul>
<li>API server: centrální vstupní bod clusteru, REST API</li>
<li>Scheduler: plánuje workload na konkrétní nody a hlídá jejich systémové zdroje (CPU, RAM, disk, ...)</li>
<li>Controller-manager: <em>hlídá</em> stav (controllerů) clusteru (deklarovaný stav vs reálný stav)</li>
<li>etcd: <em>uchovává</em> stav clusteru</li>
<li>Kubelet: "node agent" - hlídá pody, jejich kontejnery, stav node</li>
<li>Kube-proxy: na každém node směruje příchozí provoz </li>
<li>Container runtime (zde Docker): runtime pro běh kontejnerů - viz dále CNI</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [10 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              46/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-47">
          <div class="inner">
            
            <header><h1>Pod a jeho kontejnery</h1></header>
            
            
            <section>
<ul>
<li>základní abstrakcí Kubernetes je <em>Pod</em></li>
<li>Pod je nejmenší "nasaditelný" objekt, takový clusterový "atom"</li>
<li>V Podu jsou seskupeny kontejnery (jeden nebo více)</li>
<li>Pod je vždy schedulerem plánován se všemi svými kontejnery (kolokace)</li>
<li>Kontejnery v Podu nejsou izolované, ale sdílí kontext (opět Linux namespaces a cgroups)</li>
<li>Kontextem rozumíme např. sdílené úlořiště (volumes) nebo sdílený síťový namespace (komunikace přes localhost, sdílený prostor pro porty)</li>
</ul>
<p>(Příklad: examples/k8s/k8s-shared-network-ns - při delete je tam znatelná prodleva - PID 1)</p>
<p><a href="https://kubernetes.io/docs/concepts/workloads/pods/">https://kubernetes.io/docs/concepts/workloads/pods/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [10 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              47/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-48">
          <div class="inner">
            
            <header><h1>Namespaces</h1></header>
            
            
            <section>
<ul>
<li>Kubernetes namespace slouží k izolaci objektů a zdrojů</li>
<li>
<p>ale také k plošnému nastavení různých kvót, limitů a autorizací:</p>
<p><code>kubectl describe namespace amo</code></p>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              48/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-49">
          <div class="inner">
            
            <header><h1>Kubectl</h1></header>
            
            
            <section>
<ul>
<li>CLI rozhraní pro komunikaci s clusterem (resp API-serverem)</li>
<li>vyžaduje přítomnost konfiguračniho souboru, tzv. <em>kubeconfig</em> (uložen typicky v $HOME/.kube/config) - viz váš osobní kubeconfig rozesílaný před kurzem</li>
<li>kubeconfig obsahuje sady clusterů a uživatelů propojených kontexty</li>
<li>Praktické ukázky</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [20 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              49/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-50">
          <div class="inner">
            
            <header><h1>Příklad spuštění aplikace v podu – kubectl run + průzkum</h1></header>
            
            
            <section>
<ul>
<li>
<p>nejjednodušší způsob nasazení aplikace do Kubernetes:</p>
<ul>
<li><code>kubectl run app1 --image=nginx</code></li>
<li><code>kubectl create deployment app1-deployment \
    --image=nginx --replicas=2</code></li>
<li>(o deploymentu později)</li>
</ul>
</li>
<li>
<p>totéž lze docílit i vytvořením yaml - yaml je ale těžko zapamatovatelný, takže google nebo uložené šablony?</p>
</li>
<li>
<p>lepší řešení ja kombinace - vytvořit jednoduchou kostru pomocí CLI a obohacovat (příklad). To má ale smysl jen na úrovni developmentu, všude jinde zařídí CI/CD.</p>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [20 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              50/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-51">
          <div class="inner">
            
            <header><h1>K9s, Kubernetes Web IU (Dashboard)</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [10 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              51/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-52">
          <div class="inner">
            
            <header><h1>Deployment (1)</h1></header>
            
            
            <section>
<ul>
<li>vytvořínme-li pod, zajistíme si tím jen to, že nám naše aplikace tak nějak běží v Kubernetes</li>
<li>kde je ale přidaná hodnota?</li>
<li>pokud pod spadne (=proces s PID 1 v kontejneru zanikne), Kubernetes ho nastartuje automaticky znovu.</li>
<li>jak ale řešit následující potřeby?<ul>
<li>nasazení nové verze aplikace (image) bez výpadku</li>
<li>rollback nasazené verze</li>
<li>navýšení replik z důvodu rostoucí zátěže (nejlépe automaticky)</li>
<li>restart, znovunačtení konfigurace nebo změny stavu (yaml)?</li>
</ul>
</li>
<li>se samostatným Podem to lze, ale zbytečně složitě - proto existuje Deployment</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min]
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              52/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-53">
          <div class="inner">
            
            <header><h1>Deployment (2)</h1></header>
            
            
            <section>
<p>Příklad - škálování:</p>
<pre><code>- `kubectl create deployment scaling --image=nginx \
    --replicas=1 --record`
- `kubectl scale deployment scaling --replicas=10 --record`
- `kubectl rollout status deployment`
- `kubectl scale deployment scaling --replicas=4 --record`
- `kubectl rollout status deployment`
</code></pre>
<ul>
<li>1 -&gt; 10 -&gt; 0 -&gt; 4 + průzkum + --replicas=10 - vysvětlit proč jen 6 replik</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min]
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              53/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-54">
          <div class="inner">
            
            <header><h1>Deployment (3)</h1></header>
            
            
            <section><p>Rollout nové verze:</p>
<pre><code>- `kubectl create -f examples/k8s/k8s-shared-network-ns/deployment.yaml`
- `kubectl edit deployment interpod --record`
- `kubectl scale deployment interpod --replicas=2 --record`
- `kubectl scale deployment interpod --replicas=4 --record`
- `kubectl edit deployment interpod --record`
- `kubectl rollout history deployment interpod`
- `kubectl rollout history deployment interpod --revision X`
</code></pre>
<p>Vysvětlit, proč nejde rollback změn replik</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min]
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              54/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-55">
          <div class="inner">
            
            <header><h1>Deployment (4)</h1></header>
            
            
            <section><p>Rollback</p>
<pre><code>- `kubectl rollout undo deployment interpod`
- `kubectl rollout undo deployment interpod --to-revision X`
</code></pre>
<p><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">https://kubernetes.io/docs/concepts/workloads/controllers/deployment/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [5 min]
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              55/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-56">
          <div class="inner">
            
            <header><h1>Přestávka</h1></header>
            
            
            <section>
<p><img alt="docker-vs-vm" src="file:///home/amoravek/projects/trask/k8s-skoleni/git/k8s/presentation/k8s-1/../common/coffee.jpg" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [15 min]
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              56/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_code has_footer slide-57">
          <div class="inner">
            
            <header><h1>Perzistence (1)</h1></header>
            
            
            <section>
<ul>
<li>aby bylo možné uchovávat data produkovaná kontejnery v Podu, je potřeba je někam uložit (jinak zaniknou spolu s Podem)</li>
<li>
<p>na úrovni Podu (ukázat) je možné definovat externí úložiště - např.:</p>
<div class="highlight"><pre><span></span><span class="lineno">1 </span><span class="nt">volumes</span><span class="p">:</span>
<span class="lineno">2 </span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-volume</span>
<span class="lineno">3 </span>  <span class="nt">hostPath</span><span class="p">:</span>
<span class="lineno">4 </span>    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/data-xxx</span>
<span class="lineno">5 </span>    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DirectoryOrCreate</span>
</pre></div>

</li>
<li>
<p>aby bylo dostupné v <em>kontejneru</em>, je potřeba provést mount:</p>
<div class="highlight"><pre><span></span><span class="lineno">1 </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="lineno">2 </span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-volume</span>
<span class="lineno">3 </span>  <span class="nt">mountPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/data</span>
</pre></div>

</li>
<li>
<p>každý kontejner může provést mount téhož volume do jiného adresáře</p>
</li>
</ul>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/">https://kubernetes.io/docs/concepts/storage/volumes/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [20 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              57/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-58">
          <div class="inner">
            
            <header><h1>Perzistence (2)</h1></header>
            
            
            <section><ul>
<li>předchozí příklad sice funguje, ale takový přístup má řadu nedostatků:<ul>
<li>mixuje odpovědnost storage admina a vývojáře/devops inženýra</li>
<li>nelze nastavit oprávnění na úrovni Kubernetes</li>
<li>mnohdy je nutné zadat i přihlašovací údaje diktované volume pluginem</li>
<li>pokud je potřeba použít volume i z jiného Podu, je nutné duplikovat konfiguraci</li>
</ul>
</li>
</ul>
<p>Řešením je použíti PersistentVolume a PersistentVolumeClaim - příklady (examples/k8s/pv-pvc)</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [20 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              58/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-59">
          <div class="inner">
            
            <header><h1>StorageClass</h1></header>
            
            
            <section><p>Jde to ale ještě snáze - pomocí StorageClass v kombinaci se storage autoprovisioningem
(a admin se do celého procesu vůbec nemusí montovat).</p>
<p>Příklad (examples/k8s/storageclass)</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [20 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              59/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-60">
          <div class="inner">
            
            <header><h1>ConfigMap, Secret</h1></header>
            
            
            <section>
<ul>
<li>i když se mechanismy perzistence dají použít k přístupu ke konfiguračním souborům, není to dobrá praxe</li>
<li>existují totiž ConfigMap a Secret objekty - uchovávají<ul>
<li>textové i binární soubory</li>
<li>proměnné prostředí</li>
<li>citlivá data</li>
<li>PKI artefakty (certifikáty, klíče)</li>
</ul>
</li>
<li>je tu tedy další možnost separovat odpovědnost a vyjít vstříc CI/CD principům</li>
</ul>
<p>Příklad (examples/k8s/configmap-secret)</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [15 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              60/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-61">
          <div class="inner">
            
            <header><h1>Services</h1></header>
            
            
            <section>
<ul>
<li>pody mají nestabilní IP i DNS name (=název Podu)</li>
<li>
<p>Objekt Service představuje elegantní způsob řešení:</p>
<ul>
<li><code>kubectl create deployment nginx --image=nginx</code></li>
<li><code>kubectl expose deployment nginx --port 8888 --target-port 80</code></li>
</ul>
</li>
<li>
<p>ClusterIP - pouze interně v rámci clusteru</p>
</li>
<li>NodePort - jednoduchý, funkční...ale ty porty...navíc obsadí porty na všech nodech</li>
<li>LoadBalancer - nejpohodlnější, ale v cloudu drahý (samostatná IP)</li>
</ul>
<p><a href="https://kubernetes.io/docs/concepts/services-networking/service/">https://kubernetes.io/docs/concepts/services-networking/service/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [15 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              61/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-62">
          <div class="inner">
            
            <header><h1>Ingress a ingress controller</h1></header>
            
            
            <section>
<ul>
<li>objekt Ingress je pravidlo pro reverzní proxy deklarované v YAML</li>
<li>deklarujeme tedy pravidlo a o ostatní se postará reverzní proxy...a ta je kde?</li>
<li>je potřeba nainstalovat <em>ingress controller</em> (typicky kontejnerizovaný nginx nebo haproxy)</li>
<li>funguje jen pro HTTP</li>
<li>jako backend je použita Service typu ClusterIP</li>
</ul>
<p>Příklad (examples/k8s/ingress)</p>
<p>Závěr: <strong>pro HTTP je idealní vystavit ingress controller jako Service typu LoadBalancer a pro ostatní komunikaci použít buď LoadBalancer (drahé) nebo NodePort (levné, ale v Cloudu komplikované)</strong></p>
<p><a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">https://kubernetes.io/docs/concepts/services-networking/ingress/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [20 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              62/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-63">
          <div class="inner">
            
            <header><h1>Přestávka na oběd</h1></header>
            
            
            <section>
<p><img alt="obed" src="file:///home/amoravek/projects/trask/k8s-skoleni/git/k8s/presentation/k8s-1/../common/open.knedliky.jpg" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [30 min - 1 h] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              63/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-64">
          <div class="inner">
            
            <header><h1>Controllery</h1></header>
            
            
            <section>
<ul>
<li>controllery udržují v Clusteru deklarovaný (požadovaný) stav (např. počet replik Podu)</li>
<li>každý controller řeší jinou úlohu</li>
<li>správu controllerů provádí komponenta Controller-manager</li>
<li>nejpoužívanější controller je Deployment</li>
</ul>
<p><a href="https://kubernetes.io/docs/concepts/architecture/controller/">https://kubernetes.io/docs/concepts/architecture/controller/</a></p>
<p>Příklady:</p>
<p><a href="https://kubernetes.io/docs/concepts/workloads/controllers/">https://kubernetes.io/docs/concepts/workloads/controllers/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [10 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              64/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-65">
          <div class="inner">
            
            <header><h1>ReplicaSet, DaemonSet, StatefulSet, Job, CronJob</h1></header>
            
            
            <section>
<p>Příklady: examples/controllers</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [20 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              65/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-66">
          <div class="inner">
            
            <header><h1>Logování</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [10 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              66/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-67">
          <div class="inner">
            
            <header><h1>Liveness a readiness testy</h1></header>
            
            
            <section>
<ul>
<li>každý kontejner by měl mít deklarován způsob, jakým Kubelet pozná, že se správně inicializoval a zda funguje.</li>
<li>readiness probe = testuje, zda je kontejner připraven přijímat požadavky</li>
<li>liveness probe = periodicky testuje kontejner, zda je živý a zdravý</li>
<li>typy: <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#probe-v1-core">https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#probe-v1-core</a></li>
</ul>
<p><strong>Bez těchto testů nemůžeme mluvit o HA!</strong></p>
<p>Příklad: examples/k8s/readiness-liveness</p>
<p><a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/">https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [15 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              67/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-68">
          <div class="inner">
            
            <header><h1>ImagePullPolicy</h1></header>
            
            
            <section><p>imagePullPolicy: IfNotPresent vs Always</p>

<p><a href="https://kubernetes.io/docs/concepts/containers/images/#updating-images">https://kubernetes.io/docs/concepts/containers/images/#updating-images</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [10 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              68/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide has_footer slide-69">
          <div class="inner">
            
            <header><h1>Resource requests &amp; limits</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [15 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              69/70
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: k8s-1/presentation.md -->
      <div class="slide-wrapper">
        <div class="slide slide-70">
          <div class="inner">
            
            <header><h1>Diskuse</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
              [15 min] 
            
            
            <aside class="source">
              Source: <a href="k8s-1/presentation.md">k8s-1/presentation.md</a>
            </aside>
            
            <aside class="page_number">
              70/70
            </aside>
          </footer>
        </div>
      </div>
      
    </div>
  </div>
  
  <div id="toc" class="sidebar hidden">
    <h2>Table of Contents</h2>
    <table>
      <caption>Table of Contents</caption>

<!-- macro for generating subsection of TOC -->

<!-- end of macro -->

      <!-- generating sections of TOC -->
      
      <tr id="toc-row-1">
        <th><a href="#slide:1">Docker</a></th>
        <td><a href="#slide:1">1</a></td>
      </tr>
      
      
      <tr id="toc-row-2">
        <th><a href="#slide:2">Co to je Docker?</a></th>
        <td><a href="#slide:2">2</a></td>
      </tr>
      
      
      <tr id="toc-row-3">
        <th><a href="#slide:3">Srovnání s VM</a></th>
        <td><a href="#slide:3">3</a></td>
      </tr>
      
      
      <tr id="toc-row-4">
        <th><a href="#slide:4">Linux kernel</a></th>
        <td><a href="#slide:4">4</a></td>
      </tr>
      
      
      <tr id="toc-row-5">
        <th><a href="#slide:5">Motivace</a></th>
        <td><a href="#slide:5">5</a></td>
      </tr>
      
      
      <tr id="toc-row-6">
        <th><a href="#slide:6">Image</a></th>
        <td><a href="#slide:6">6</a></td>
      </tr>
      
      
      <tr id="toc-row-7">
        <th><a href="#slide:7">Parent a base image</a></th>
        <td><a href="#slide:7">7</a></td>
      </tr>
      
      
      <tr id="toc-row-8">
        <th><a href="#slide:8">Kontejner</a></th>
        <td><a href="#slide:8">8</a></td>
      </tr>
      
      
      <tr id="toc-row-9">
        <th><a href="#slide:9">Docker daemon</a></th>
        <td><a href="#slide:9">9</a></td>
      </tr>
      
      
      <tr id="toc-row-10">
        <th><a href="#slide:10">OCI</a></th>
        <td><a href="#slide:10">10</a></td>
      </tr>
      
      
      <tr id="toc-row-11">
        <th><a href="#slide:11">Docker CLI</a></th>
        <td><a href="#slide:11">11</a></td>
      </tr>
      
      
      <tr id="toc-row-12">
        <th><a href="#slide:12">Dockerfile</a></th>
        <td><a href="#slide:12">12</a></td>
      </tr>
      
      
      <tr id="toc-row-13">
        <th><a href="#slide:13">Příklad (1)</a></th>
        <td><a href="#slide:13">13</a></td>
      </tr>
      
      
      <tr id="toc-row-14">
        <th><a href="#slide:14">Příklad (2)</a></th>
        <td><a href="#slide:14">14</a></td>
      </tr>
      
      
      <tr id="toc-row-15">
        <th><a href="#slide:15">Příklad (3)</a></th>
        <td><a href="#slide:15">15</a></td>
      </tr>
      
      
      <tr id="toc-row-16">
        <th><a href="#slide:16">Příklad (4)</a></th>
        <td><a href="#slide:16">16</a></td>
      </tr>
      
      
      <tr id="toc-row-17">
        <th><a href="#slide:17">docker kontext</a></th>
        <td><a href="#slide:17">17</a></td>
      </tr>
      
      
      <tr id="toc-row-18">
        <th><a href="#slide:18">Přestávka do 10:45</a></th>
        <td><a href="#slide:18">18</a></td>
      </tr>
      
      
      <tr id="toc-row-19">
        <th><a href="#slide:19">Dockerfile - příkazy (1)</a></th>
        <td><a href="#slide:19">19</a></td>
      </tr>
      
      
      <tr id="toc-row-20">
        <th><a href="#slide:20">Dockerfile - příkazy (2)</a></th>
        <td><a href="#slide:20">20</a></td>
      </tr>
      
      
      <tr id="toc-row-21">
        <th><a href="#slide:21">PID 1, exec vs shell formy</a></th>
        <td><a href="#slide:21">21</a></td>
      </tr>
      
      
      <tr id="toc-row-22">
        <th><a href="#slide:22">Build a vrstvy</a></th>
        <td><a href="#slide:22">22</a></td>
      </tr>
      
      
      <tr id="toc-row-23">
        <th><a href="#slide:23">Multi-stage build</a></th>
        <td><a href="#slide:23">23</a></td>
      </tr>
      
      
      <tr id="toc-row-24">
        <th><a href="#slide:24">Názvy images, Docker repository</a></th>
        <td><a href="#slide:24">24</a></td>
      </tr>
      
      
      <tr id="toc-row-25">
        <th><a href="#slide:25">Docker registry</a></th>
        <td><a href="#slide:25">25</a></td>
      </tr>
      
      
      <tr id="toc-row-26">
        <th><a href="#slide:26">Secure/insecure</a></th>
        <td><a href="#slide:26">26</a></td>
      </tr>
      
      
      <tr id="toc-row-27">
        <th><a href="#slide:27">harbor.trask.cz</a></th>
        <td><a href="#slide:27">27</a></td>
      </tr>
      
      
      <tr id="toc-row-28">
        <th><a href="#slide:28">pull, push, tag, login/logout</a></th>
        <td><a href="#slide:28">28</a></td>
      </tr>
      
      
      <tr id="toc-row-29">
        <th><a href="#slide:29">Přestávka na oběd</a></th>
        <td><a href="#slide:29">29</a></td>
      </tr>
      
      
      <tr id="toc-row-30">
        <th><a href="#slide:30">PID 1 podrobněji</a></th>
        <td><a href="#slide:30">30</a></td>
      </tr>
      
      
      <tr id="toc-row-31">
        <th><a href="#slide:31">Uživatelské účty a oprávnění uvnitř kontejneru, USER</a></th>
        <td><a href="#slide:31">31</a></td>
      </tr>
      
      
      <tr id="toc-row-32">
        <th><a href="#slide:32">Publikace portů, EXPOSE</a></th>
        <td><a href="#slide:32">32</a></td>
      </tr>
      
      
      <tr id="toc-row-33">
        <th><a href="#slide:33">Volumes</a></th>
        <td><a href="#slide:33">33</a></td>
      </tr>
      
      
      <tr id="toc-row-34">
        <th><a href="#slide:34">Networking, komunikace mezi kontejnery</a></th>
        <td><a href="#slide:34">34</a></td>
      </tr>
      
      
      <tr id="toc-row-35">
        <th><a href="#slide:35">Přestávka</a></th>
        <td><a href="#slide:35">35</a></td>
      </tr>
      
      
      <tr id="toc-row-36">
        <th><a href="#slide:36">Docker best practices</a></th>
        <td><a href="#slide:36">36</a></td>
      </tr>
      
      
      <tr id="toc-row-37">
        <th><a href="#slide:37">Orchestrace – Docker Compose, Docker Swarm</a></th>
        <td><a href="#slide:37">37</a></td>
      </tr>
      
      
      <tr id="toc-row-38">
        <th><a href="#slide:38">Přidělování CPU a paměti</a></th>
        <td><a href="#slide:38">38</a></td>
      </tr>
      
      
      <tr id="toc-row-39">
        <th><a href="#slide:39">Kontejnerizace Java aplikace, JIB</a></th>
        <td><a href="#slide:39">39</a></td>
      </tr>
      
      
      <tr id="toc-row-40">
        <th><a href="#slide:40">Diskuse</a></th>
        <td><a href="#slide:40">40</a></td>
      </tr>
      
      
      <tr id="toc-row-41">
        <th><a href="#slide:41">Kubernetes I.</a></th>
        <td><a href="#slide:41">41</a></td>
      </tr>
      
      
      <tr id="toc-row-42">
        <th><a href="#slide:42">Potřeba orchestrace kontejnerů</a></th>
        <td><a href="#slide:42">42</a></td>
      </tr>
      
      
      <tr id="toc-row-43">
        <th><a href="#slide:43">Kubernetes</a></th>
        <td><a href="#slide:43">43</a></td>
      </tr>
      
      
      <tr id="toc-row-44">
        <th><a href="#slide:44">Příklad deklarativního způsobu konfigurace (YAML)</a></th>
        <td><a href="#slide:44">44</a></td>
      </tr>
      
      
      <tr id="toc-row-45">
        <th><a href="#slide:45">Architektura Kubernetes (1)</a></th>
        <td><a href="#slide:45">45</a></td>
      </tr>
      
      
      <tr id="toc-row-46">
        <th><a href="#slide:46">Architektura Kubernetes (2)</a></th>
        <td><a href="#slide:46">46</a></td>
      </tr>
      
      
      <tr id="toc-row-47">
        <th><a href="#slide:47">Pod a jeho kontejnery</a></th>
        <td><a href="#slide:47">47</a></td>
      </tr>
      
      
      <tr id="toc-row-48">
        <th><a href="#slide:48">Namespaces</a></th>
        <td><a href="#slide:48">48</a></td>
      </tr>
      
      
      <tr id="toc-row-49">
        <th><a href="#slide:49">Kubectl</a></th>
        <td><a href="#slide:49">49</a></td>
      </tr>
      
      
      <tr id="toc-row-50">
        <th><a href="#slide:50">Příklad spuštění aplikace v podu – kubectl run + průzkum</a></th>
        <td><a href="#slide:50">50</a></td>
      </tr>
      
      
      <tr id="toc-row-51">
        <th><a href="#slide:51">K9s, Kubernetes Web IU (Dashboard)</a></th>
        <td><a href="#slide:51">51</a></td>
      </tr>
      
      
      <tr id="toc-row-52">
        <th><a href="#slide:52">Deployment (1)</a></th>
        <td><a href="#slide:52">52</a></td>
      </tr>
      
      
      <tr id="toc-row-53">
        <th><a href="#slide:53">Deployment (2)</a></th>
        <td><a href="#slide:53">53</a></td>
      </tr>
      
      
      <tr id="toc-row-54">
        <th><a href="#slide:54">Deployment (3)</a></th>
        <td><a href="#slide:54">54</a></td>
      </tr>
      
      
      <tr id="toc-row-55">
        <th><a href="#slide:55">Deployment (4)</a></th>
        <td><a href="#slide:55">55</a></td>
      </tr>
      
      
      <tr id="toc-row-56">
        <th><a href="#slide:56">Přestávka</a></th>
        <td><a href="#slide:56">56</a></td>
      </tr>
      
      
      <tr id="toc-row-57">
        <th><a href="#slide:57">Perzistence (1)</a></th>
        <td><a href="#slide:57">57</a></td>
      </tr>
      
      
      <tr id="toc-row-58">
        <th><a href="#slide:58">Perzistence (2)</a></th>
        <td><a href="#slide:58">58</a></td>
      </tr>
      
      
      <tr id="toc-row-59">
        <th><a href="#slide:59">StorageClass</a></th>
        <td><a href="#slide:59">59</a></td>
      </tr>
      
      
      <tr id="toc-row-60">
        <th><a href="#slide:60">ConfigMap, Secret</a></th>
        <td><a href="#slide:60">60</a></td>
      </tr>
      
      
      <tr id="toc-row-61">
        <th><a href="#slide:61">Services</a></th>
        <td><a href="#slide:61">61</a></td>
      </tr>
      
      
      <tr id="toc-row-62">
        <th><a href="#slide:62">Ingress a ingress controller</a></th>
        <td><a href="#slide:62">62</a></td>
      </tr>
      
      
      <tr id="toc-row-63">
        <th><a href="#slide:63">Přestávka na oběd</a></th>
        <td><a href="#slide:63">63</a></td>
      </tr>
      
      
      <tr id="toc-row-64">
        <th><a href="#slide:64">Controllery</a></th>
        <td><a href="#slide:64">64</a></td>
      </tr>
      
      
      <tr id="toc-row-65">
        <th><a href="#slide:65">ReplicaSet, DaemonSet, StatefulSet, Job, CronJob</a></th>
        <td><a href="#slide:65">65</a></td>
      </tr>
      
      
      <tr id="toc-row-66">
        <th><a href="#slide:66">Logování</a></th>
        <td><a href="#slide:66">66</a></td>
      </tr>
      
      
      <tr id="toc-row-67">
        <th><a href="#slide:67">Liveness a readiness testy</a></th>
        <td><a href="#slide:67">67</a></td>
      </tr>
      
      
      <tr id="toc-row-68">
        <th><a href="#slide:68">ImagePullPolicy</a></th>
        <td><a href="#slide:68">68</a></td>
      </tr>
      
      
      <tr id="toc-row-69">
        <th><a href="#slide:69">Resource requests &amp; limits</a></th>
        <td><a href="#slide:69">69</a></td>
      </tr>
      
      
      <tr id="toc-row-70">
        <th><a href="#slide:70">Diskuse</a></th>
        <td><a href="#slide:70">70</a></td>
      </tr>
      
      
    </table>
  </div>
  
  <div id="help" class="sidebar hidden">
    <h2>Help</h2>
    <table>
      <caption>Help</caption>
      <tr>
        <th>Table of Contents</th>
        <td>t</td>
      </tr>
      <tr>
        <th>Exposé</th>
        <td>ESC</td>
      </tr>
      <tr>
        <th>Presenter View</th>
        <td>p</td>
      </tr>
      <tr>
        <th>Source Files</th>
        <td>s</td>
      </tr>
      <tr>
        <th>Slide Numbers</th>
        <td>n</td>
      </tr>
      <tr>
        <th>Toggle screen blanking</th>
        <td>b</td>
      </tr>
      <tr>
        <th>Show/hide next slide</th>
        <td>c</td>
      </tr>
      <tr>
        <th>Notes</th>
        <td>2</td>
      </tr>
      <tr>
        <th>Help</th>
        <td>h</td>
      </tr>
    </table>
    <br>
    <strong>Generated with Darkslide 5.1.0</strong>
  </div>
  <script>main()</script>
</body>
</html>